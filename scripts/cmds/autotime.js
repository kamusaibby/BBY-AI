const moment = require('moment-timezone');

module.exports.config = {
  name: "autotime",
  version: "7.1",
  role: 0,
  author: Buffer.from("QW50aG9ueQ==", "base64").toString("utf-8"), //Editing by Bayjid
  category: "autotime",
  countDown: 3,
};

module.exports.onLoad = async ({ api }) => {
  try {
    const allowedAuthor = Buffer.from("QW50aG9ueQ==", "base64").toString("utf-8");
    if (module.exports.config.author !== allowedAuthor) {
      throw new Error("Author field has been altered! The file will not work. \n \nUse this name [Anthony] Set this author name ðŸŽ€");
    }

    const messages = {
      "00:00": "ðŸŒ™ à¦°à¦¾à¦¤ à§§à§¨:à§¦à§¦! à¦¨à¦¤à§à¦¨ à¦¦à¦¿à¦¨ à¦¶à§à¦°à§! à¦†à¦œà¦•à§‡à¦° à¦²à¦•à§à¦·à§à¦¯ à¦ à¦¿à¦• à¦•à¦°à§‹! ðŸ’«",
      "01:00": "ðŸŒ  à¦°à¦¾à¦¤ à§¦à§§:à§¦à§¦! à¦à¦‡ à¦¨à¦¿à¦°à¦¬ à¦°à¦¾à¦¤à§‡à¦“ à¦•à§‡à¦‰ à¦¸à§à¦¬à¦ªà§à¦¨ à¦—à§œà¦›à§‡! à¦¤à§à¦®à¦¿ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤ à¦¤à§‹? ðŸš€",
      "02:00": "ðŸŒŒ à¦°à¦¾à¦¤ à§¦à§¨:à§¦à§¦! à¦°à¦¾à¦¤ à¦¯à¦¤ à¦—à¦­à§€à¦°, à¦¸à¦¾à¦«à¦²à§à¦¯à§‡à¦° à¦ªà¦¥ à¦¤à¦¤ à¦•à¦ à¦¿à¦¨! ðŸ”¥",
      "03:00": "ðŸŒ™ à¦°à¦¾à¦¤ à§¦à§©:à§¦à§¦! à¦•à§‡à¦‰ à¦œà§‡à¦—à§‡ à¦ªà¦°à¦¿à¦•à¦²à§à¦ªà¦¨à¦¾ à¦•à¦°à¦›à§‡, à¦•à§‡à¦‰ à¦˜à§à¦®à¦¾à¦šà§à¦›à§‡! à¦¤à§à¦®à¦¿ à¦•à§‹à¦¨ à¦¦à¦²à§‡? ðŸ¤”",
      "04:00": "ðŸŒ„ à¦°à¦¾à¦¤ à§¦à§ª:à§¦à§¦! à¦¸à¦«à¦² à¦®à¦¾à¦¨à§à¦·à¦°à¦¾ à¦à¦–à¦¨à¦‡ à¦¦à¦¿à¦¨ à¦¶à§à¦°à§ à¦•à¦°à§‡! à¦¤à§à¦®à¦¿ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤ à¦¤à§‹? â³",
      "05:00": "ðŸŒž à¦¸à¦•à¦¾à¦² à§¦à§«:à§¦à§¦! à¦¨à¦¤à§à¦¨ à¦¸à¦•à¦¾à¦²à§‡à¦° à¦¶à§à¦°à§, à¦†à¦œà¦•à§‡à¦° à¦¦à¦¿à¦¨à¦Ÿà¦¾ à¦¸à§à¦ªà§‡à¦¶à¦¾à¦² à¦•à¦°à§‹! â˜€ï¸",
      "06:00": "â˜€ï¸ à¦¸à¦•à¦¾à¦² à§¦à§¬:à§¦à§¦! à¦¸à¦•à¦¾à¦²à¦¬à§‡à¦²à¦¾ à¦¨à¦¤à§à¦¨ à¦¸à¦®à§à¦­à¦¾à¦¬à¦¨à¦¾à¦° à¦¬à¦¾à¦°à§à¦¤à¦¾ à¦¨à¦¿à§Ÿà§‡ à¦†à¦¸à§‡! ðŸ’¡",
      "07:00": "ðŸ¥ à¦¸à¦•à¦¾à¦² à§¦à§­:à§¦à§¦! à¦ªà§à¦°à¦¾à¦¤à¦ƒà¦°à¦¾à¦¶ à¦•à¦°à§‹, à¦¸à§à¦¸à§à¦¥ à¦¥à¦¾à¦•à§‹, à¦¶à¦•à§à¦¤à¦¿à¦¶à¦¾à¦²à§€ à¦¹à¦“! ðŸ‹ï¸",
      "08:00": "ðŸ“š à¦¸à¦•à¦¾à¦² à§¦à§®:à§¦à§¦! à¦†à¦œà¦•à§‡ à¦¨à¦¤à§à¦¨ à¦•à¦¿à¦›à§ à¦¶à§‡à¦–à¦¾à¦° à¦œà¦¨à§à¦¯ à¦ªà¦¾à¦°à¦«à§‡à¦•à§à¦Ÿ à¦¸à¦®à§Ÿ! ðŸŽ“",
      "09:00": "ðŸ’» à¦¸à¦•à¦¾à¦² à§¦à§¯:à§¦à§¦! à¦•à¦ à§‹à¦° à¦ªà¦°à¦¿à¦¶à§à¦°à¦®à¦‡ à¦¸à¦¾à¦«à¦²à§à¦¯à§‡à¦° à¦à¦•à¦®à¦¾à¦¤à§à¦° à¦šà¦¾à¦¬à¦¿à¦•à¦¾à¦ à¦¿! ðŸ”‘",
      "10:00": "ðŸ“ à¦¸à¦•à¦¾à¦² à§§à§¦:à§¦à§¦! à¦†à¦œà¦•à§‡à¦° à¦•à¦¾à¦œà¦—à§à¦²à§‹à¦° à¦ªà§à¦°à§‹à¦¡à¦¾à¦•à§à¦Ÿà¦¿à¦­à¦¿à¦Ÿà¦¿ à¦¸à¦°à§à¦¬à§‹à¦šà§à¦š à¦•à¦°à§‹! ðŸ“ˆ",
      "11:00": "ðŸ•š à¦¸à¦•à¦¾à¦² à§§à§§:à§¦à§¦! à¦†à¦°à§‡à¦•à¦Ÿà§ à¦®à¦¨à§‹à¦¯à§‹à¦— à¦¦à¦¾à¦“, à¦¸à¦«à¦²à¦¤à¦¾ à¦à¦•à¦¦à¦® à¦•à¦¾à¦›à§‡! ðŸ”¥",
      "12:00": "â˜€ï¸ à¦¦à§à¦ªà§à¦° à§§à§¨:à§¦à§¦! à¦¦à§à¦ªà§à¦°à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦–à§‡à§Ÿà§‡ à¦¶à¦°à§€à¦° à¦“ à¦®à¦¨ à¦°à¦¿à¦šà¦¾à¦°à§à¦œ à¦•à¦°à§‹! ðŸ›",
      "13:00": "ðŸ½ï¸ à¦¦à§à¦ªà§à¦° à§¦à§§:à§¦à§¦! à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“, à¦¤à¦¾à¦°à¦ªà¦° à¦†à¦¬à¦¾à¦° à¦•à¦¾à¦œà§‡ à¦«à¦¿à¦°à§‡ à¦†à¦¸à§‹! â³",
      "14:00": "ðŸ“– à¦¦à§à¦ªà§à¦° à§¦à§¨:à§¦à§¦! à¦à¦•à¦Ÿà§ à¦¬à§à¦°à§‡à¦• à¦¨à¦¾à¦“, à¦«à§à¦°à§‡à¦¶ à¦¹à§Ÿà§‡ à¦¨à¦¾à¦“! ðŸƒ",
      "15:00": "â˜• à¦¬à¦¿à¦•à¦¾à¦² à§¦à§©:à§¦à§¦! à¦à¦• à¦•à¦¾à¦ª à¦šà¦¾ à¦¬à¦¾ à¦•à¦«à¦¿ à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦à¦¨à¦¾à¦°à§à¦œà¦¿ à¦¦à¦¿à¦¬à§‡! ðŸµ",
      "16:00": "ðŸŒ¿ à¦¬à¦¿à¦•à¦¾à¦² à§¦à§ª:à§¦à§¦! à¦†à¦œà¦•à§‡à¦° à¦…à¦—à§à¦°à¦—à¦¤à¦¿ à¦šà§‡à¦• à¦•à¦°à§‹, à¦†à¦°à§‡à¦•à¦Ÿà§ à¦à¦—à¦¿à§Ÿà§‡ à¦¯à¦¾à¦“! ðŸš€",
      "17:00": "ðŸš¶ à¦¬à¦¿à¦•à¦¾à¦² à§¦à§«:à§¦à§¦! à¦à¦•à¦Ÿà§ à¦¹à¦¾à¦à¦Ÿà¦¾à¦¹à¦¾à¦à¦Ÿà¦¿ à¦•à¦°à§‹, à¦¶à¦°à§€à¦°à¦•à§‡ à¦°à¦¿à¦«à§à¦°à§‡à¦¶ à¦•à¦°à§‹! ðŸƒ",
      "18:00": "ðŸŒ† à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à§¦à§¬:à§¦à§¦! à¦†à¦œà¦•à§‡à¦° à¦•à¦¾à¦œà§‡à¦° à¦«à¦²à¦¾à¦«à¦² à¦•à§‡à¦®à¦¨? à¦°à¦¿à¦­à¦¿à¦‰ à¦•à¦°à§‹! ðŸ“Š",
      "19:00": "ðŸ  à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à§¦à§­:à§¦à§¦! à¦ªà¦°à¦¿à¦¬à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦¸à¦®à§Ÿ à¦•à¦¾à¦Ÿà¦¾à¦“, à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¾ à¦¶à§‡à§Ÿà¦¾à¦° à¦•à¦°à§‹! â¤ï¸",
      "20:00": "ðŸŽ¶ à¦°à¦¾à¦¤ à§¦à§®:à§¦à§¦! à¦¨à¦¿à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦•à¦¿à¦›à§ à¦¸à¦®à§Ÿ à¦¨à¦¾à¦“, à¦°à¦¿à¦²à§à¦¯à¦¾à¦•à§à¦¸ à¦•à¦°à§‹! ðŸŽ¬",
      "21:00": "ðŸ“± à¦°à¦¾à¦¤ à§¦à§¯:à§¦à§¦! à¦†à¦œà¦•à§‡à¦° à¦¶à§‡à¦–à¦¾ à¦“ à¦…à¦°à§à¦œà¦¨ à¦¨à¦¿à§Ÿà§‡ à¦­à¦¾à¦¬à§‹, à¦«à§‹à¦¨ à¦•à¦® à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à§‹! ðŸ“µ",
      "22:00": "ðŸ˜´ à¦°à¦¾à¦¤ à§§à§¦:à§¦à§¦! à¦•à¦¾à¦²à¦•à§‡à¦° à¦œà¦¨à§à¦¯ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¾à¦“, à¦˜à§à¦®à¦¾à¦“! ðŸ’¤"
    };

    const sendScheduledMessage = () => {
      const now = moment().tz('Asia/Dhaka');
      const currentHour = now.format('HH:00');

      if (messages[currentHour]) {
        if (global.db && global.db.allThreadData) {
          const threadIDs = global.db.allThreadData.map(i => i.threadID);
          threadIDs.forEach(async (threadID) => {
            try {
              const styledMessage = `ðŸ”¥ ð—”ð—¨ð—§ð—¢ ð—§ð—œð— ð—˜ ð—¨ð—£ð——ð—”ð—§ð—˜ ðŸ”¥\n\n` +
                `ðŸ’¬ ${messages[currentHour]}\n\n` +
                `â° ð—§ð—¶ð—ºð—²: ${currentHour} ðŸ•’\n\n` +
                `ðŸ“ ð—§ð—¶ð—ºð—² ð—­ð—¼ð—»ð—²: Asia/Dhaka ðŸ‡§ðŸ‡©`;

              await api.sendMessage(styledMessage, threadID);
            } catch (error) {
              console.error("Error sending message:", error);
            }
          });
        }
      }

      const nextHour = moment().add(1, 'hour').startOf('hour');
      const delay = nextHour.diff(moment());
      setTimeout(sendScheduledMessage, delay);
    };

    sendScheduledMessage();
  } catch (error) {
    console.error("Error in onLoad:", error);
  }
};

module.exports.onStart = () => {};
